2022/12/4

# 回溯法

rongtianfu@gmail.com

## 回溯法框架

回溯法本质上是一种搜索算法，但是带有一定的跳跃性，因此比一般的搜索算法更为高效。

在使用回溯法的时候，我们往往需要构建解空间树，并在这棵树上进行深度优先搜索，每当遇到一个节点的时候，首先判断该节点是否具有问题的解，如果可能包含问题的解则进入进行搜索，否则跳过该节点（及其子树上的所有节点）并搜索后续节点。

回溯法求解问题的时候，只要得到问题的一个解就结束。

回溯法的基本思路可以概括如下：

- 构建问题的解空间：解具有什么样的形式？在该形式下，解一共有多少种情况？
- 将解空间组织起来，常见的思路是按照树结构进行组织
- 从开始节点出发，以深度优先方式搜索整个解空间
- 在搜索过程中使用剪枝函数减去不可能的子空间
- 回溯的两种思路：递归回溯、迭代回溯
- 子集树与排列树：
  - 子集树：往往是二叉树，分别表示当前活结点对应的物品是选还是不选
  - 排列树：往往是多叉树，表示当前步骤中选择哪一个物品放入当前位置



## 装载问题

> 有一批共有$n$个集装箱要装上两艘载重量分别为$c_1$和$c_2$的货船，其中第$i$个集装箱的重量为$w_i$，要求确定是否有方案可以将这$n$个集装箱装上货船，如果有则找出一种装载方案

这是子集树问题。

我们的目标是将所有集装箱装入两艘货船，因此对于其中一批集装箱而言，我们希望其承载的集装箱总重量尽可能接近$c_1$，这样才有最有可能将所有集装箱装上两艘货船。

约束函数：如果当前箱子装上去的重量大于$c_1$，则在当前步骤下不考虑装载该箱子的情况。同样，如果当前价值加上剩余总价值小于当前最优价值，则不进行该子树的搜索。



## 批处理作业调度

> 给定$n$个作业，每个作业都需要在两台机器上完成（必须先由机器$1$进行处理、然后由机器$2$进行处理），且第$i$个作业在第$j$台机器上的处理时间为$t_{ij}$，试确定一种调度方案，使总的处理时间最短

这是排列树问题。

对于第一个进入机器$1$的作业，有$n$个选择，我们需要做的就是遍历这$n$个选择，并进行相应的第二个进入到机器$1$的作业的选择，并不断递归，直到最后选择完毕所有的作业，就构成了一个序列。

显然，我们需要一个辅助的数据结构`selected[i]`表示第$i$个作业是否已经被选择。

约束函数：如果当前选择的作业序列所花费的时间已经超过最优解，那么就不再进行这一选择后相应的递归。



## 符号三角形

> 给定一个数字$n$，表示第一行有$n$个符号，符号位加号或者减号，两个同号下面是加号、两个异号下面是减号，问一共有多少个不同的三角形含有的加号和减号数量相同

设数组`x[i]`表示第$%j$个字符是加号还是减号（$1$表示加号、$0$表示减号），显然的思路就是逐行递归直到当前行只有$1$个元素，并且在递归的过程中维护加号和减号的数量。

约束函数：如果加号和减号的数量相差过大、以至于就算三角形中剩下的位置全部填满其中较少的那个也无法使两种符号相等，则剪枝。定量地讲，对于给定的$n$，可以知道总的符号数量为$n(n+1)/2$，因此加号和减号的数量一定为$n(n+1)/4$，以此作为剪枝标准。

注意这道题具体的实现思路，很巧妙，当我们确定了第$i$个元素之后，可以构建第一行为前$i$个元素时所对应的小三角形，并记下此时加号和减号的数量；然后确定第$i+1$个元素，此时第一行为前$i+1$个元素时所对应的三角形可以通过向第一行为前$i$个元素时所对应的小三角形右侧增加”一条元素“来构造得到！



## $n$皇后

> 在$n\times n$格的棋盘上防止彼此不攻击的$n$个皇后，问有多少种放法

当我们放置一个皇后之后，可以据此皇后所在位置去对其他皇后的可能的位置进行剪枝。



## 连续邮资

> 假设有$n$种面值的邮票，并且一个信封上最多允许贴$m$张邮票，”连续邮资“指每次增加$1$，试求出在给定$n$和$m$时的最大连续邮资区间（限制最低邮资从$1$开始），并给出相应的面值设计方案

由于最低邮资一定从$1$开始，那么所有面值的最小面值一定是$1$。我们接下来需要确定下一个面值，为了进行剪枝操作降低复杂度，我们需要确定下一个面值的上界和下界：

- 下界：上一张面值加一
- 上界：当前所能达到的最大面值加一，如果再大则会出现断层

据此便可以使用回溯法求解问题。